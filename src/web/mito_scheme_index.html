<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>

<style>
    div.tooltip {
        position: absolute;
        text-align: match-parent;
        width: auto;
        height: auto;
        padding: 3px;
        font: 12px sans-serif;
        background: lightgray;
        border: 0px;
        border-radius: 4px;
        pointer-events: none;
    }

    .label {
        font-family: 'Nanum Gothic', sans-serif;
        text-anchor: middle;
    }

    .mito {
        border-radius: 100px;
        fill: palevioletred;
    }

    .synapse {
        fill: rebeccapurple;
    }

    .spine {
        stroke-width: 3px;
        stroke: lightgreen;
    }
</style>

<!-- Create a div where the graph will take place -->
<div id="my_dataviz"></div>
<script src="qrc:///qtwebchannel/qwebchannel.js" type="text/javascript"></script>
<script>
    new QWebChannel(qt.webChannelTransport, function (channel) {

        let jsobject = channel.objects.mito_scheme_data;
        let json_string = jsobject.json_string;
        let hvgx = parseInt(jsobject.hvgx_id);
        let data = JSON.parse(json_string);

        let semantic_skeleton = ""
        for (let i = 0; i < data.length; i++) {
            if (parseInt(data[i].id) + 1 == hvgx) {
                semantic_skeleton = data[i]
            }
        }

        console.log(semantic_skeleton)

        // set the dimensions and margins of the graph
        let margin = {top: 10, right: 30, bottom: 90, left: 40},
            width = 460 - margin.left - margin.right,
            height = 500 - margin.top - margin.bottom;

        // append the svg object to the body of the page
        let svg = d3.select("#my_dataviz")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

        // Append Div for tooltip to SVG
        let div = d3.select("body")
            .append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);


        // X axis
        let x = d3.scaleBand()
            .range([0, width])
            .domain([0, 1])
            .padding(1);

        svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x).tickValues([]));

        // Add Y axis
        let y = d3.scaleLinear()
            .domain([0, 13000])
            .range([height, 0]);

        // Lines
        svg.selectAll("myline")
            .data(semantic_skeleton.branches)
            .enter()
            .append("line")
            .attr("x1", function (d) {
                return width * d.start;
            })
            .attr("x2", function (d) {
                return width * d.start + 1;
            })
            .attr("y1", function (d) {
                return height;
            })
            .attr("y2", function (d){
                return height - 50 * d.length / height;
            })
            .attr("class", "spine")
        // .on("mouseover", function (d) {
        //     div.transition()
        //         .duration(200)
        //         .style("opacity", .9);
        //
        //     div.text("Spine01 - Length: " + y(d.Value))
        //         .style("left", (d3.event.pageX) + "px")
        //         .style("top", (d3.event.pageY - 28) + "px");
        // })
        // .on("mouseout", function () {
        //     div.transition()
        //         .duration(100)
        //         .style("opacity", 0);
        // });

        svg.append("rect")
            .attr("x", 0.2 * width)
            .attr("y", height - margin.top)
            .attr("width", 0.5 * width)
            .attr("height", 10)
            .attr("class", "mito")
            .on("mouseover", function (d) {
                div.transition()
                    .duration(200)
                    .style("opacity", .9);

                div.text("Mito047")
                    .style("left", (d3.event.pageX) + "px")
                    .style("top", (d3.event.pageY - 28) + "px");
            })
            .on("mouseout", function () {
                div.transition()
                    .duration(100)
                    .style("opacity", 0);
            });

        // Circles
        // svg.selectAll("mycircle")
        //     .data(data)
        //     .enter()
        //     .append("circle")
        //     .attr("cx", function (d) {
        //         return x(d.Country);
        //     })
        //     .attr("cy", function (d) {
        //         return y(d.Value);
        //     })
        //     .attr("r", function (d) {
        //         return d.Value / 500;
        //     })
        //     .attr("class", "synapse")
        //     .on("mouseover", function (d) {
        //         div.transition()
        //             .duration(200)
        //             .style("opacity", .9);
        //
        //         div.text("Synapse Bla Bla - SA: " + d.Value / 500)
        //             .style("left", (d3.event.pageX) + "px")
        //             .style("top", (d3.event.pageY - 28) + "px");
        //     })
        //     .on("mouseout", function () {
        //         div.transition()
        //             .duration(100)
        //             .style("opacity", 0);
        //     });

    });

</script>